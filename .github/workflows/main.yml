name: Build and Release Next.js Standalone

on:
    push:
        branches:
            - main # jalan setiap push ke main
            
permissions: 
    contents: write

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repo
              uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: 24

            - name: Install dependencies
              run: npm i --legacy-peer-deps

            - name: Build Next.js (standalone)
              run: npm run build

            - name: Copy public and static into standalone
              run: |
                  cp -r public .next/standalone/ || true
                  cp -r .next/static .next/standalone/.next/ || true

            - name: Archive standalone build
              run: |
                  cd .next/standalone
                  zip -r ../../nextjs-standalone.zip ./*

            - name: Create Release
              uses: softprops/action-gh-release@v2
              with:
                  files: nextjs-standalone.zip
                  tag_name: latest 
                  name: "Latest Build"
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
